<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta charset="utf-8"/>
<script type="text/javascript" src="opentype.js"></script>
<script type="text/javascript" src="pako.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="bootstrap-slider.css">
<script type="text/javascript" src="bootstrap-slider.js"></script>

<style type="text/css">
font-family: 'Roboto', sans-serif; font-family: 'Open Sans', sans-serif; font-family: 'Lato', sans-serif; font-family: 'Roboto Condensed', sans-serif; font-family: 'Slabo 27px', serif; font-family: 'Oswald', sans-serif; font-family: 'Montserrat', sans-serif; font-family: 'Source Sans Pro', sans-serif; font-family: 'Raleway', sans-serif; font-family: 'Just Another Hand', handwriting; font-family: 'PT Sans', sans-serif; font-family: 'Roboto Slab', serif; font-family: 'Merriweather', serif; font-family: 'Open Sans Condensed', sans-serif; font-family: 'Lora', serif; font-family: 'Droid Sans', sans-serif; font-family: 'Ubuntu', sans-serif; font-family: 'Droid Serif', serif; font-family: 'Noto Sans', sans-serif; font-family: 'Playfair Display', serif; font-family: 'Arimo', sans-serif; font-family: 'PT Serif', serif; font-family: 'Titillium Web', sans-serif; font-family: 'Poppins', sans-serif; font-family: 'Muli', sans-serif; font-family: 'PT Sans Narrow', sans-serif; font-family: 'Anton', sans-serif; font-family: 'Indie Flower', handwriting; font-family: 'Yanone Kaffeesatz', sans-serif; font-family: 'Noto Serif', serif; font-family: 'Bitter', serif; font-family: 'Dosis', sans-serif; font-family: 'Josefin Sans', sans-serif; font-family: 'Lobster', display; font-family: 'Inconsolata', monospace; font-family: 'Hind', sans-serif; font-family: 'Oxygen', sans-serif; font-family: 'Fjalla One', sans-serif; font-family: 'Crimson Text', serif; font-family: 'Nunito', sans-serif; font-family: 'Caveat Brush', handwriting; font-family: 'Arvo', serif; font-family: 'Cabin', sans-serif; font-family: 'Catamaran', sans-serif; font-family: 'Dancing Script', handwriting; font-family: 'Quicksand', sans-serif; font-family: 'Libre Baskerville', serif; font-family: 'Fira Sans', sans-serif; font-family: 'Ubuntu Condensed', sans-serif; font-family: 'Exo 2', sans-serif; font-family: 'Roboto Mono', monospace; font-family: 'Work Sans', sans-serif; font-family: 'Rubik', sans-serif; font-family: 'Abril Fatface', display; font-family: 'Bree Serif', serif; font-family: 'Cairo', sans-serif; font-family: 'Patua One', display; font-family: 'Merriweather Sans', sans-serif; font-family: 'Abel', sans-serif; font-family: 'Asap', sans-serif; font-family: 'Pacifico', handwriting; font-family: 'Kaushan Script', handwriting; font-family: 'Karla', sans-serif; font-family: 'Teko', sans-serif; font-family: 'Righteous', display; font-family: 'Alfa Slab One', display; font-family: 'Signika', sans-serif; font-family: 'Varela Round', sans-serif; font-family: 'Great Vibes', handwriting; font-family: 'Gloria Hallelujah', handwriting; font-family: 'Shadows Into Light', handwriting; font-family: 'Archivo Narrow', sans-serif; font-family: 'Questrial', sans-serif; font-family: 'Acme', sans-serif; font-family: 'Francois One', sans-serif; font-family: 'Play', sans-serif; font-family: 'Cuprum', sans-serif; font-family: 'PT Sans Caption', sans-serif; font-family: 'Vollkorn', serif; font-family: 'Archivo Black', sans-serif; font-family: 'EB Garamond', serif; font-family: 'Maven Pro', sans-serif; font-family: 'Crete Round', serif; font-family: 'Libre Franklin', sans-serif; font-family: 'Pathway Gothic One', sans-serif; font-family: 'Alegreya', serif; font-family: 'Passion One', display; font-family: 'Exo', sans-serif; font-family: 'Permanent Marker', handwriting; font-family: 'Khula', sans-serif; font-family: 'Amatic SC', handwriting; font-family: 'Rokkitt', serif; font-family: 'Kanit', sans-serif; font-family: 'Source Code Pro', monospace; font-family: 'Source Serif Pro', serif; font-family: 'Comfortaa', display; font-family: 'Monda', sans-serif; font-family: 'Ropa Sans', sans-serif; font-family: 'Josefin Slab', serif; font-family: 'Yantramanav', sans-serif;
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans|Lato|Roboto+Condensed|Slabo+27px|Oswald|Montserrat|Source+Sans+Pro|Raleway|Just+Another+Hand|PT+Sans|Roboto+Slab|Merriweather|Open+Sans+Condensed|Lora|Droid+Sans|Ubuntu|Droid+Serif|Noto+Sans|Playfair+Display|Arimo|PT+Serif|Titillium+Web|Poppins|Muli|PT+Sans+Narrow|Anton|Indie+Flower|Yanone+Kaffeesatz|Noto+Serif|Bitter|Dosis|Josefin+Sans|Lobster|Inconsolata|Hind|Oxygen|Fjalla+One|Crimson+Text|Nunito|Caveat+Brush|Arvo|Cabin|Catamaran|Dancing+Script|Quicksand|Libre+Baskerville|Fira+Sans|Ubuntu+Condensed|Exo+2|Roboto+Mono|Work+Sans|Rubik|Abril+Fatface|Bree+Serif|Cairo|Patua+One|Merriweather+Sans|Abel|Asap|Pacifico|Kaushan+Script|Karla|Teko|Righteous|Alfa+Slab+One|Signika|Varela+Round|Great+Vibes|Gloria+Hallelujah|Shadows+Into+Light|Archivo+Narrow|Questrial|Acme|Francois+One|Play|Cuprum|PT+Sans+Caption|Vollkorn|Archivo+Black|EB+Garamond|Maven+Pro|Crete+Round|Libre+Franklin|Pathway+Gothic+One|Alegreya|Passion+One|Exo|Permanent+Marker|Khula|Amatic+SC|Rokkitt|Kanit|Source+Code+Pro|Source+Serif+Pro|Comfortaa|Monda|Ropa+Sans|Josefin+Slab|Yantramanav">
<style type="text/css">
.jumbotron{
	padding-top:2rem;
}
</style>
<style type="text/css">@font-face{font-family:"Comic Sans"; src:url("comic.ttf"); }</style>
<script type="text/javascript">
old="";
function main(arg) {
	//opentype.load('comic.ttf', function(err, font) {
	//if (err) {
	//	alert('Could not load font: ' + err);
	//} else {
		textarea=document.getElementById("input");
		
		old = textarea.value;
		canvas=document.getElementById("text");
		ctx=canvas.getContext('2d');
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		fontsizeslider=document.getElementById("ex6");
		size = fontsizeslider.value;

		if (size == 0) size = 32;

		console.log(document.getElementById("font").value);
		ctx.font = size + "px " + document.getElementById("font").value;
		console.log(textarea.value);
		lines=textarea.value.split("\n");
		for (var i = 0; i < lines.length; i++) {
		console.log(ctx.fillText(lines[i],0,((size/1)*i) + size));
			//lines[i]
		}


		o=ctx.getImageData(0,0,canvas.width,canvas.height);
		
		console.log(o);
		out = [];
		for (var i = 0; i < o.data.length; i += 4) {

			p = i/4;
			x = p%canvas.width;
			y = (p-x)/canvas.width;
			//console.log(o.data[i+3]);
			if (o.data[i+3] > 255/2){
				//console.log(x,y);
				out.push({"x":x,"y":y});
			}
		}
		print(out);
	}

function print(points) {

	base = {"blueprint":{"icons":[{"signal":{"type":"item","name":"concrete"},"index":1}],"tiles":[],"item":"blueprint","version":64426672129}}
	maxX = -999999;
	maxY = -999999;
	minX = 999999;
	minY = 999999;

	for (var i = points.length - 1; i >= 0; i--) {
		if (points[i]["x"] > maxX ) maxX = points[i]["x"];
		if (points[i]["y"] > maxY ) maxY = points[i]["y"];

		if (points[i]["x"] < minX ) minX = points[i]["x"];
		if (points[i]["y"] < minY ) minY = points[i]["y"];
	}
	
	centerX = Math.round((maxX/2)+(minX/2));
	centerY = Math.round((maxY/2)+(minY/2));

	console.log(minX, maxX, centerX, minX-centerX, maxX-centerX);
	console.log(minY, maxY, centerY, minY-centerY, maxY-centerY);

	
tile=document.getElementById("tile").value;
	for (var i = points.length - 1; i >= 0; i--) {
	a = {"x": points[i]["x"] - centerX, "y": points[i]["y"] - centerY };
	base["blueprint"]["tiles"].push({"position":a,"name":tile});
	}

	b = pako.deflate(JSON.stringify(base), { to: 'string' });
	res =  "0"+btoa(b);
	console.log(res);
	document.getElementById("resutl").value = res;
}

/*Lorem ipsum dolor sit amet, consectetur adipisicing elit,
sed do eiusmod tempor incididunt ut labore et dolore magna
aliqua. Ut enim ad minim veniam, quis nostrud exercitation
ullamco laboris nisi ut aliquip ex ea commodo consequat.
Duis aute irure dolor in reprehenderit in voluptate velit
esse cillum dolore eu fugiat nulla pariatur. Excepteur sint
occaecat cupidatat non proident, sunt in culpa qui officia
deserunt mollit anim id est laborum.*/

function loadSlider() {

// Without JQuery
var slider = new Slider("#ex6");
slider.on("slide", function(sliderValue) {
	document.getElementById("ex6SliderVal").textContent = sliderValue;
	main();
});
}

function loadClipp(){
var copyTextareaBtn = document.getElementById('clip-but');

copyTextareaBtn.addEventListener('click', function(event) {
  var copyTextarea = document.getElementById('resutl');
  console.log(copyTextarea);
  //copyTextarea.disabled =false;
  copyTextarea.select();

  try {
    var successful = document.execCommand('copy');
    var msg = successful ? 'successful' : 'unsuccessful';
    console.log('Copying text command was ' + msg);
  } catch (err) {
    console.log('Oops, unable to copy');
  }
  //copyTextarea.disabled =true;
});
}


document.addEventListener('DOMContentLoaded', loadSlider);
document.addEventListener('DOMContentLoaded', loadClipp);




document.addEventListener('DOMContentLoaded', main);
document.addEventListener('DOMContentLoaded', function (){
	document.getElementById('input').addEventListener('keyup', main);
	document.getElementById("tile").addEventListener('change', main);
	document.getElementById("font").addEventListener('change', main);
});
</script>
</head>
<body>
	<div class="container">
	  <div class="header clearfix">
		<nav>
		  <ul class="nav nav-pills float-right">
			<li class="nav-item">
			  <a class="nav-link" href="https://github.com/KilledKenny/factorio-concrete"><i class="fa fa-github" style="font-size:24px"></i> Github</a>
			</li>
		  </ul>
		</nav>
		<h3 class="text-muted">Concrete</h3>
	  </div>
</div>
	  <div class="container">
		<img src="concrete.png" class="img-fluid">
		<p></p>
		</div>
	

<div class="container">
<div class="jumbotron">

			<div class="row">
				<div class="col-sm-12">
					<div class="form-group">
						<label>Text to convert</label>
						<textarea class="form-control" id="input">Concrete</textarea>
					</div>
				</div>

				
			</div>
			<div class="row">
			<div class="col-sm-6">
			<div class="row">
			<div class="col-sm-12">
				<label>Font</label>
					<select class="form-control" id="font">
					<option>Comic Sans</option>
					<option>Roboto</option>
					<option>Open Sans</option>
					<option>Lato</option>
					<option>Roboto Condensed</option>
					<option>Slabo 27px</option>
					<option>Oswald</option>
					<option>Montserrat</option>
					<option>Source Sans Pro</option>
					<option>Raleway</option>
					<option>Just Another Hand</option>
					<option>PT Sans</option>
					<option>Roboto Slab</option>
					<option>Merriweather</option>
					<option>Open Sans Condensed</option>
					<option>Lora</option>
					<option>Droid Sans</option>
					<option>Ubuntu</option>
					<option>Droid Serif</option>
					<option>Noto Sans</option>
					<option>Playfair Display</option>
					<option>Arimo</option>
					<option>PT Serif</option>
					<option>Titillium Web</option>
					<option>Poppins</option>
					<option>Muli</option>
					<option>PT Sans Narrow</option>
					<option>Anton</option>
					<option>Indie Flower</option>
					<option>Yanone Kaffeesatz</option>
					<option>Noto Serif</option>
					<option>Bitter</option>
					<option>Dosis</option>
					<option>Josefin Sans</option>
					<option>Lobster</option>
					<option>Inconsolata</option>
					<option>Hind</option>
					<option>Oxygen</option>
					<option>Fjalla One</option>
					<option>Crimson Text</option>
					<option>Nunito</option>
					<option>Caveat Brush</option>
					<option>Arvo</option>
					<option>Cabin</option>
					<option>Catamaran</option>
					<option>Dancing Script</option>
					<option>Quicksand</option>
					<option>Libre Baskerville</option>
					<option>Fira Sans</option>
					<option>Ubuntu Condensed</option>
					<option>Exo 2</option>
					<option>Roboto Mono</option>
					<option>Work Sans</option>
					<option>Rubik</option>
					<option>Abril Fatface</option>
					<option>Bree Serif</option>
					<option>Cairo</option>
					<option>Patua One</option>
					<option>Merriweather Sans</option>
					<option>Abel</option>
					<option>Asap</option>
					<option>Pacifico</option>
					<option>Kaushan Script</option>
					<option>Karla</option>
					<option>Teko</option>
					<option>Righteous</option>
					<option>Alfa Slab One</option>
					<option>Signika</option>
					<option>Varela Round</option>
					<option>Great Vibes</option>
					<option>Gloria Hallelujah</option>
					<option>Shadows Into Light</option>
					<option>Archivo Narrow</option>
					<option>Questrial</option>
					<option>Acme</option>
					<option>Francois One</option>
					<option>Play</option>
					<option>Cuprum</option>
					<option>PT Sans Caption</option>
					<option>Vollkorn</option>
					<option>Archivo Black</option>
					<option>EB Garamond</option>
					<option>Maven Pro</option>
					<option>Crete Round</option>
					<option>Libre Franklin</option>
					<option>Pathway Gothic One</option>
					<option>Alegreya</option>
					<option>Passion One</option>
					<option>Exo</option>
					<option>Permanent Marker</option>
					<option>Khula</option>
					<option>Amatic SC</option>
					<option>Rokkitt</option>
					<option>Kanit</option>
					<option>Source Code Pro</option>
					<option>Source Serif Pro</option>
					<option>Comfortaa</option>
					<option>Monda</option>
					<option>Ropa Sans</option>
					<option>Josefin Slab</option>
					<option>Yantramanav</option>
					</select>
			</div>
			<div class="col-sm-12">
				<label>Tile</label>
					<select class="form-control" id="tile">
					<option value="concrete">Concrete</option>
					<option value="stone-path">Stone</option>
					<option value="hazard-concrete-right">Hazard Concrete (Right)</option>
					<option value="hazard-concrete-left">Hazard Concrete (Left)</option>

					</select>
			</div>
			<div class="col-sm-12">
				<div class="form-group">
				<span id="ex6CurrentSliderValLabel">Font size: <span id="ex6SliderVal">3</span></span><br>
				<input id="ex6" type="text" data-slider-min="12" data-slider-max="64" data-slider-step="1" data-slider-value="32"/>
				
				</div>
			</div>
			</div>
			</div>
				<div class="col-sm-6">
					<div class="form-group">
						<label>Blueprint String</label>
						<textarea class="form-control" id="resutl"></textarea>
						<br>
						<button  class="btn btn-primary" id="clip-but">Copy to clipboard</button>
					</div>
				</div>
			
			</div>
		
		<br>
		<div class="col-sm-12">
		<label>Preview</label>
		<canvas id="text" width="1000" height="400"></canvas>
		</div>
	  </div>

	  <footer class="footer">
		<p>The end...</p>
	  </footer>

	</div> <!-- /container -->

</body>
</html>